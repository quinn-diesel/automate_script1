from pycommon.aws import invoke_lambda


class ServiceException(Exception):
    pass


def make_payload(name, identity, args=None):
    return {'field': name, 'arguments': args or {}, 'identity': identity}


def call_service(function, identity, field, args=None):
    result = invoke_lambda(function, make_payload(field, identity, args))
    for e in ('error', 'errorMessage'):
        if e in result:
            raise ServiceException(
                'Error calling {}: {}'.format(function, result[e]))
    return result
